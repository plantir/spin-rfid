<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Example Form</title>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div>
      <div id="state">Unknown!</div>
      <input type="text" id="userRfId" />
    </div>

    <script>
      var exampleSocket = null;

      function reconnect() {
        if (
          exampleSocket &&
          (exampleSocket.readyState === WebSocket.OPEN ||
            exampleSocket.readyState === WebSocket.CONNECTING)
        ) {
          clearInterval(connectionTimer);
          return;
        }

        window.wsConnectionTimer = setInterval(() => {
          connect();
        }, 3000);
      }

      function connect() {
        $("#state").text("Connecting...");
        exampleSocket = new WebSocket("ws://localhost:7777");

        exampleSocket.onopen = function(event) {
          exampleSocket.send("i'm ready!");
          $("#state").text("Connected");
          clearInterval(window.wsConnectionTimer);
        };

        exampleSocket.onclose = function(event) {
          $("#state").text("Closed");
          reconnect();
        };

        exampleSocket.onmessage = function(event) {
          $("#userRfId").val(event.data);
        };
      }
      connect();
    </script>
  </body>
</html>
